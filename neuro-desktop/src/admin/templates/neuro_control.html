<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Neuro Control Settings</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
  <div class="container">
    <a class="navbar-brand" href="/">Neuro Desktop Admin</a>
    <ul class="navbar-nav ms-auto">
      <li class="nav-item"><a class="nav-link" href="/">Configs</a></li>
      <li class="nav-item"><a class="nav-link" href="/plugins">Plugins</a></li>
      <li class="nav-item"><a class="nav-link active" href="/neuro-control">Neuro Control</a></li>
    </ul>
  </div>
</nav>

<div class="container my-4">
  <h1 class="mb-3">Neuro Control Settings</h1>
  <div id="alert" class="alert d-none" role="alert"></div>

  <form id="form" class="card p-3 shadow-sm">
    <div class="form-check form-switch mb-3">
      <input class="form-check-input" type="checkbox" id="enabled">
      <label class="form-check-label" for="enabled">Enable Neuro Desktop Control (OFF by default)</label>
    </div>

    <div class="mb-3">
      <label class="form-label" for="theme">Theme</label>
      <select id="theme" class="form-select">
        <option>Dark</option>
        <option>Light</option>
        <option>Neuro Purple</option>
        <option>Evil Red</option>
      </select>
    </div>

    <div class="form-check mb-3">
      <input class="form-check-input" type="checkbox" id="autostart">
      <label class="form-check-label" for="autostart">Start Neuro Desktop on Windows startup</label>
    </div>

    <div class="mb-3">
      <label class="form-label" for="allowed_actions">Allowed Actions (comma-separated)</label>
      <input id="allowed_actions" class="form-control" placeholder="e.g., open_app, click, type">
    </div>

    <div class="d-flex gap-2">
      <button type="button" class="btn btn-primary" onclick="save()">Save</button>
      <a class="btn btn-secondary" href="/">Back</a>
    </div>
  </form>
</div>

<script>
async function load() {
  const res = await fetch('/api/neuro-control');
  const data = await res.json();
  document.getElementById('enabled').checked = !!data.enabled;
  document.getElementById('theme').value = data.theme || 'Dark';
  document.getElementById('autostart').checked = !!data.autostart;
  document.getElementById('allowed_actions').value = (data.allowed_actions || []).join(', ');
}
function notify(kind, msg) {
  const el = document.getElementById('alert');
  el.className = 'alert alert-' + kind;
  el.textContent = msg;
  el.classList.remove('d-none');
  setTimeout(() => el.classList.add('d-none'), 2500);
}
async function save() {
  const payload = {
    enabled: document.getElementById('enabled').checked,
    theme: document.getElementById('theme').value,
    autostart: document.getElementById('autostart').checked,
    allowed_actions: document.getElementById('allowed_actions').value
      .split(',')
      .map(s => s.trim())
      .filter(Boolean)
  };
  const res = await fetch('/api/neuro-control', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify(payload)
  });
  const data = await res.json();
  if (data.success) notify('success', 'Settings saved');
  else notify('danger', data.error || 'Save failed');
}
document.addEventListener('DOMContentLoaded', load);
</script>
</body>
</html>
